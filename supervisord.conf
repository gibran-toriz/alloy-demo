[supervisord]
nodaemon=true

; Only start the exporter relevant to this node type, based on NODE_TYPE and DEVICE_TYPE env vars
; The following blocks are templates. The entrypoint script will generate the correct supervisord.conf for each node.

; Node Exporter (for servers)
[program:node_exporter]
command=/usr/bin/prometheus-node-exporter --web.listen-address=:9600 --collector.disable-defaults --collector.cpu --collector.meminfo --collector.loadavg --collector.uname
autorestart=true
user=root
environment=NODE_TYPE=%(ENV_NODE_TYPE)s

; Custom Exporter (for custom nodes)
[program:custom_exporter]
command=/bin/bash /opt/custom_exporters/custom_exporter.sh
autorestart=true
user=root
environment=NODE_TYPE=%(ENV_NODE_TYPE)s

; POS Exporter (for POS nodes)
[program:retail_pos_exporter]
command=/bin/bash /opt/custom_exporters/retail_pos_exporter.sh 9300
autorestart=true
user=root
environment=NODE_TYPE=%(ENV_NODE_TYPE)s

; Network Device Exporter (for routers)
[program:network_device_exporter_router]
command=/bin/bash /opt/custom_exporters/network_device_exporter.sh 9400
autorestart=true
user=root
environment=NODE_TYPE=%(ENV_NODE_TYPE)s,DEVICE_TYPE=%(ENV_DEVICE_TYPE)s

; Network Device Exporter (for switches)
[program:network_device_exporter_switch]
command=/bin/bash /opt/custom_exporters/network_device_exporter.sh 9500
autorestart=true
user=root
environment=NODE_TYPE=%(ENV_NODE_TYPE)s,DEVICE_TYPE=%(ENV_DEVICE_TYPE)s

[program:alloy]
command=/usr/bin/alloy run /etc/alloy/config.river
autorestart=true
user=root
stdout_logfile=/tmp/alloy_stdout.log
stderr_logfile=/tmp/alloy_stderr.log

; In production, use an entrypoint script to generate a minimal supervisord.conf with only the needed exporter block enabled for each node type.